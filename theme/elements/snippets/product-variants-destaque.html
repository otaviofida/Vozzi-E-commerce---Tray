<style>
    .s-section-highlights .mid-product .content .variants .option-color li{
        position: relative;
        cursor: pointer;
    }
    .s-section-highlights .mid-product .content .variants .option-color li::before{
        content: '-';
        position: absolute;
        top: 0;
        left: 0;
    }
    </style>
    
    {% if product.available and (product.stock > 0 or settings.without_stock_sale) and not product.upon_request %}
    <div class="variants">
    
    {% set productVar = product.Variants|length ? product.Variants : product.variants %}
    {% set listMain = [] %}
    {% set listColor = [] %}
    {% set variants = [] %}
    {% set mainName = '' %}
    {% set colorIndex = null %}
    {% set mainIndex = null %}
    
    {% for variant in productVar %}
    
        {% if loop.first %}
            {% if variant.Sku[0].type == 'Cor' %}
                {% set colorIndex = 0 %}
                {% set mainIndex = 1 %}
            {% elseif variant.Sku[1] is defined and variant.Sku[1].type == 'Cor' %}
                {% set colorIndex = 1 %}
                {% set mainIndex = 0 %}
            {% endif %}
    
            {% set mainName = variant.Sku[mainIndex].type %}
        {% endif %}
    
        {% set stock = settings.without_stock_sale ? '99999' : variant.stock %}
    
        {# NORMALIZAÇÃO #}
        {% set mainValue = variant.Sku[mainIndex].value
            | url_encode
            | replace({
                '%E1':'a','%E0':'a','%E2':'a','%E3':'a','%E4':'a',
                '%E9':'e','%E8':'e','%EA':'e','%EB':'e',
                '%ED':'i','%EC':'i','%EE':'i','%EF':'i',
                '%F3':'o','%F2':'o','%F4':'o','%F5':'o','%F6':'o',
                '%FA':'u','%F9':'u','%FB':'u','%FC':'u',
                '%E7':'c','%20':' '
            })
        %}
    
        {% set colorValue = variant.Sku[colorIndex].value
            | url_encode
            | replace({
                '%E1':'a','%E0':'a','%E2':'a','%E3':'a','%E4':'a',
                '%E9':'e','%E8':'e','%EA':'e','%EB':'e',
                '%ED':'i','%EC':'i','%EE':'i','%EF':'i',
                '%F3':'o','%F2':'o','%F4':'o','%F5':'o','%F6':'o',
                '%FA':'u','%F9':'u','%FB':'u','%FC':'u',
                '%E7':'c','%20':' '
            })
        %}
    
        {% set variants = variants|merge([{
            "id": variant.id,
            "stock": stock,
            "main": mainValue,
            "color": colorValue,
            "price": {
                "price": variant.price_offer != 0 ? variant.price_offer : variant.price,
                "payment": variant.payment_option,
                "payment_html": variant.payment_option_html | e('html')
            },
            "imageColor": variant.Sku[colorIndex].image_secure,
            "imageProduct": variant.images[0] is defined ? variant.images[0].full : ''
        }]) %}
    
        {% if mainValue not in listMain %}
            {% set listMain = listMain|merge([mainValue]) %}
        {% endif %}
    
        {% if colorValue not in listColor %}
            {% set listColor = listColor|merge([colorValue]) %}
        {% endif %}
    
    {% endfor %}
    
    <form class="list-variants"
          data-id="{{ product.id }}"
          data-variants='{{ variants|json_encode }}'
          data-api-cart="1">
    
        {# VARIAÇÃO PRINCIPAL (MARCA, TAMANHO, ETC) #}
        <label class="select-variants">
            <div class="variant-types">
                <span>{{ mainName }}</span>
            </div>
            <select class="first option-select" required>
                <option value="" hidden>Selecione</option>
                {% for value in listMain %}
                    <option value="{{ value }}">{{ value }}</option>
                {% endfor %}
            </select>
        </label>
    
        {# COR — SEMPRE VISUAL #}
        <div class="color-select">
            <div class="variant-types">
                <span>Cor</span>
            </div>
            <ul class="second option-select option-color">
                {% for value in listColor %}
                    {% set img = '' %}
                    {% for v in variants %}
                        {% if v.color == value %}
                            {% set img = v.imageColor %}
                        {% endif %}
                    {% endfor %}
                    <li data-value="{{ value }}" data-img="{{ img }}">
                        <img src="{{ img }}" alt="{{ value }}" class="color_select">
                    </li>
                {% endfor %}
            </ul>
        </div>
    
        <div class="alert-dont-stock" style="display:none">
            <p>Variação indisponível</p>
        </div>
    
        <div class="flex add-cart">
            <div data-app="product.quantity" class="qtd-prod flex">
                <button type="button" data-app="product.qty" data-action="minus" data-product="{{ product.id }}">−</button>
                <input type="text" min="1" max="99" name="qty" value="1">
                <button type="button" data-app="product.qty" data-action="plus" data-product="{{ product.id }}">+</button>
            </div>
    
            <button class="action add-to-cart botao" data-product="{{ product.id }}">
                Comprar
            </button>
        </div>
    </form>
    
    </div>
    {% endif %}

    <script>
        document.querySelectorAll('.option-color li').forEach(li => {
            const img = li.dataset.img;
            li.style.setProperty('--bg-img', `url(${img})`);
        });
    </script>